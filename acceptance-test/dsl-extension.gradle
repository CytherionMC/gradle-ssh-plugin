
class RemoteFileAssertion {
    def assertFileContains(String path, String regexp) {
        execute("egrep '$regexp' '$path'")
    }
}

task('feature: remote file assertion') << {
    def x = randomInt()
    def pathX = remoteTempPath('X')
    ssh.run {
        settings {
            extensions.add RemoteFileAssertion
        }
        session(remotes.localhost) {
            execute "echo 'port $x' > $pathX"
            assertFileContains pathX, "port $x"
        }
    }
}
