
task('feature: execute a shell') << {
    ssh.run {
        session(remotes.localhost) {
            shell(interaction: {
                when(partial: ~/.*[$%#] */) {
                    standardInput << 'exit 0' << '\n'
                }
            })
        }
    }
}

task('feature: write output of the shell to a file') << {
    def x = randomInt()
    def y = randomInt()
    localWorkDir.mkdir()
    def resultFile = file("$localWorkDir/result")
    resultFile.withOutputStream { stream ->
        ssh.run {
            session(remotes.localhost) {
                execute "expr $x + $y", outputStream: stream
            }
        }
    }
    assert resultFile.text as int == (x + y)
}

task('feature: write output of the shell to stdout') << {
    ssh.run {
        session(remotes.localhost) {
            shell outputStream: System.out, interaction: {
                when(partial: ~/.*[$%#] */) {
                    standardInput << 'exit 0' << '\n'
                }
            }
        }
    }
}
